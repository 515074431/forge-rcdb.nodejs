import ServiceDlg from 'Dialogs/ServiceDlg'
import ClientAPI from 'ClientAPI'
import BaseSvc from './BaseSvc'
import React from 'react'

export default class DialogSvc extends BaseSvc {

  /////////////////////////////////////////////////////////////////
  //
  //
  /////////////////////////////////////////////////////////////////
  constructor (opts) {

    super (opts)

    this.close = this.close.bind(this)
  }

  /////////////////////////////////////////////////////////////////
  //
  //
  /////////////////////////////////////////////////////////////////
  setComponent (component) {

    this.component = component

    this.setState ({
      close: this.close,
      open: false
    })
  }

  /////////////////////////////////////////////////////////////////
  //
  //
  /////////////////////////////////////////////////////////////////
  setState (state) {

    return new Promise ((resolve) => {

      const dialogSvcState = Object.assign({},
        this.getState(), state)

      const componentState = Object.assign({},
        this.component.state, {
          dialogSvc: dialogSvcState
        })

      this.component.setState(componentState, () => {

        resolve()
      })
    })
  }

  /////////////////////////////////////////////////////////////////
  //
  //
  /////////////////////////////////////////////////////////////////
  getState () {

    return this.component.state.dialogSvc
  }

  /////////////////////////////////////////////////////////////////
  //
  //
  /////////////////////////////////////////////////////////////////
  name() {

    return 'DialogSvc'
  }

  /////////////////////////////////////////////////////////////////
  //
  //
  /////////////////////////////////////////////////////////////////
  close (result) {

    this.setState ({

      open: false

    }).then(() => {

      this.emit('dialog.close', result)
    })
  }

  /////////////////////////////////////////////////////////////////
  //
  //
  /////////////////////////////////////////////////////////////////
  render() {

    const state = this.getState()

    return <ServiceDlg {...state}/>
  }
}
